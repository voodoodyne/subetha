<web-app xmlns="http://caucho.com/ns/resin"
	xmlns:cfg="urn:java:com.caucho.config"
	xmlns:jms="urn:java:com.caucho.jms"
	xmlns:ejb="urn:java:com.caucho.ejb"
	xmlns:adm="java:urn:org.subethamail.core.admin"
	xmlns:util="java:urn:org.subethamail.core.util"
	xmlns:sec="java:urn:org.subethamail.web.security"
	>

	<sec:ResinLogin/>
	<util:SubEthaAuthenticator/>

	<resource
		mbean-name="subetha:name=Cleanup"
		type="org.subethamail.core.admin.CleanupBean"
		mbean-interface="org.subethamail.core.admin.CleanupManagement" />

	<resource
		mbean-name="subetha:name=SMTPService"
		type="org.subethamail.core.smtp.SMTPService"
		mbean-interface="org.subethamail.core.smtp.SMTPManagement" />

	<!-- Run every night at 4am (base 0 below) -->
	<resin:ScheduledTask>
		<task>
			<adm:CleanupBean />
		</task>
		<cron>0 3 *</cron>
	</resin:ScheduledTask>

	<!-- JMS -->
	<jms:JmsConnectionFactory />

	<jms:MemoryQueue>
		<util:InjectQueue/>
		<Named>injectedMsgIds</Named>
	</jms:MemoryQueue>

	<ejb-message-bean class="org.subethamail.core.queue.InjectListener">
		<destination>#{injectedMsgIds}</destination>
	</ejb-message-bean>

	<jms:MemoryQueue>
		<util:DeliveryQueue/>
		<Named>deliverableMessages</Named>
	</jms:MemoryQueue>

	<ejb-message-bean class="org.subethamail.core.queue.DeliveryListener">
		<destination>#{deliverableMessages}</destination>
	</ejb-message-bean>


	<database jndi-name="jdbc/subetha">
		<ping>true</ping>
		<ping-interval>0</ping-interval>
		<ping-query>select 1;</ping-query>

		<driver type="org.postgresql.Driver">
			<url>jdbc:postgresql://localhost/subetha</url>
			<user>subetha</user>
			<password>subetha</password>
		</driver>
	</database>

	<ejb-server data-source="jdbc/test"
		validate-database-schema="true" create-database-schema="true" />

</web-app>